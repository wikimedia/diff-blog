jQuery(document).ready(function(t){var e,n,a=wpdiscuzAjaxObj;function r(e){t("+ .lang-board",e).fadeIn(500),e.addClass("opened"),t("+ .lang-board",e).addClass("opened-board")}function d(e){var n=t("#trns-"+e).attr("data-lang");t.each(a.trns_lang_list,function(n,a){t(".all-lang-board").find(".trns-"+n).attr("id",n+"-"+e)}),t(".all-lang-board").find("#"+n+"-"+e).hide(),t(".all-lang-board").fadeIn(500)}function o(){t(".opened-board").fadeOut(500),t(".all-lang-board").hide(),t(".trns-moderate-comment").removeClass("opened"),t(".lang-board").removeClass("opened-board"),t(".all-lang-board").find("span").show(50)}function i(e){e?e-=13:e=13;var n=".wpd-thread-list";t(".wc-thread-wrapper-search").find(".search-result").length&&(n=".wc-thread-wrapper-search"),t(n).find(".wpd-comment:last").css({"margin-bottom":e+"px"})}t(document).mouseup(function(e){t(e.target).closest(".opened").length||t(e.target).closest(".all-lang-content").length||(o(),i())}),t(document).delegate(".trns-into-cr","click",function(){o()}),t(document).delegate(".original-text","click",function(){var e=t(this).attr("id").split("-")[1],n=".wpd-thread-list";if(t(".wc-thread-wrapper-search").find(".search-result").length&&(n=".wc-thread-wrapper-search"),t("#comment-"+e).find("#wpdiscuz-edit-form").length){var a=t("#comment-"+e).find("#wpdiscuz-edit-form").find(".wc_comment_original").val();t("#comment-"+e).find("#wpdiscuz-edit-form").find(".wc_edit_comment").val(a)}else t(n).find("#comment-"+e).find(".wpd-comment-text").not(".wc-comment-translated-text").show(),t(n).find(".translated-"+e).hide();t(this).hide(),t(n).find("#mod-"+e).show()}),t(document).delegate(".trns-moderate-comment","click",function(){var n=t(this),o=n.attr("id").split("-")[1],s=".wpd-thread-list";t(".wc-thread-wrapper-search").find(".search-result").length&&(s=".wc-thread-wrapper-search");var l=t(s).find(".wpd-comment:last").attr("id").split("-")[2].split("_")[0];if(n.next(".lang-board").find(".trns-temporary").is("span")){var m=n.next(".lang-board").find(".trns-temporary").attr("id").split("-")[0];n.next(".lang-board").find("#"+m+"-"+o).hasClass("trns-primary")?n.next(".lang-board").find(".trns-temporary").remove():n.next(".lang-board").find(".trns-temporary").attr("id",m+"-"+o)}"untranslatable"!==n.attr("data-lang")?"none"===n.attr("data-lang")?(t(".wpdiscuz-loading-bar").show(),e&&e.abort(),e=t.ajax({type:"post",url:wpdiscuzAjaxObj.url,data:{action:"discuz-trns",action_kind:"detect-lang",comm_id:o}}).done(function(e){try{var s=t.parseJSON(e);if(t(".wpdiscuz-loading-bar").hide(),s.lang){var m=s.lang;if("und"!==m){if(n.attr("data-lang",m),t("#"+m+"-"+o).remove(),n.next(".lang-board").find(".translate-buttons > span").length>1?r(n):d(o),l==o)i(n.next(".lang-board").outerHeight())}else"und"===m&&(wpdiscuzAjaxObj.setCommentMessage(n,"trns-error-dialog",a.trns_error_dialog,!1),n.attr("data-lang","untranslatable"))}else console.warn(s.error)}catch(t){console.warn(t)}})):n.next(".lang-board").find(".translate-buttons > span").length>1?(t(".translate-buttons").find("#"+n.attr("data-lang")+"-"+o).remove(),r(n),l===o&&i(n.next(".lang-board").outerHeight())):d(o):(t(".wpdiscuz-loading-bar").hide(),wpdiscuzAjaxObj.setCommentMessage(n,"trns-error-dialog",a.trns_error_dialog,!1))}),t(document).delegate(".trns-lang","click",function(){var e=t(this),r=e.attr("id").split("-"),d=r[0].replace("_","-"),i=r[1],s=t("#trns-"+i).attr("data-lang"),l=".wpd-thread-list";if(t(".wc-thread-wrapper-search").find(".search-result").length&&(l=".wc-thread-wrapper-search"),o(),e.hasClass("lang-now"))t("#comment-"+i).find(".wpd-comment-text").not(".wc-comment-translated-text").hide(),t("#comment-"+i).find(".wc-comment-translated-text").toggle(),t("#comment-"+i).find(".trns-moderate-comments").toggle(),t("#comment-"+i).find(".original-text").toggle();else if("untranslatable"!==e.attr("data-lang"))if(s!==d)if(t(l).find("#trns-"+d+"-"+i).length)t(l).find("#comment-"+i).find(".wpd-comment-text").not(".wc-comment-translated-text").hide(),t(l).find("#trns-"+d+"-"+i).show(),t(l).find("#comment-"+i).find(".trns-moderate-comments").hide(),t(l).find("#orig-"+i).show();else{t(".wpdiscuz-loading-bar").show();var m=t("#comment-"+i).find(".wpd-comment-text").not(".wc-comment-translated-text").text();n&&n.abort(),n=t.ajax({type:"post",url:wpdiscuzAjaxObj.url,data:{action:"discuz-trns",action_kind:"trns-comm",comm_id:i,lang_from:s,lang_to:d}}).done(function(n){try{var r=t.parseJSON(n);if(t(".wpdiscuz-loading-bar").hide(),r.trnsComment){if(t("#comment-"+i).find("#wpdiscuz-edit-form").length){var o=t("#comment-"+i).find("#wpdiscuz-edit-form").find(".wc_edit_comment").val();t("#comment-"+i).find("#wpdiscuz-edit-form").find(".wc_edit_comment").after('<textarea class="wc_comment_original" style="display:none;">'+o+"</textarea>"),t("#comment-"+i).find("#wpdiscuz-edit-form").find(".wc_edit_comment").val(r.trnsComment)}else t("#comment-"+i).find(".wpd-comment-text").not(".wc-comment-translated-text").hide(),t("#comment-"+i).find(".wpd-comment-text").not(".wc-comment-translated-text").after('<div title="'+m+'" class="wpd-comment-text wc-comment-translated-text translated-'+i+'" id="trns-'+d+"-"+i+'">'+r.trnsComment+"</div>"),t(l).find("#trns-"+d+"-"+i).show();t(l).find("#comment-"+i).find(".trns-moderate-comments").hide(),t("#comment-"+i).find(".single-trns-lang").addClass("lang-now"),t("#orig-"+i).attr("title",a.trns_lang_list[s]),t(l).find("#orig-"+i).show()}else wpdiscuzAjaxObj.setCommentMessage(e,"trns-error-dialog",a.trns_error_dialog,!1),console.warn(r.error),e.attr("data-lang","untranslatable")}catch(t){console.warn(t)}})}else wpdiscuzAjaxObj.setCommentMessage(t("#all-"+i),"trns-error-dialog",a.trns_same_lang_msg+" "+a.trns_lang_list[s],!1);else wpdiscuzAjaxObj.setCommentMessage(e,"trns-error-dialog",a.trns_error_dialog,!1)}),t(document).delegate(".show-all-langs","click",function(){d(t(this).attr("id").split("-")[1])}),t(document).delegate(".trns-lang-all","hover",function(){if(t(window).width()>330){var e=t(this).text();t(".trns-into").find(".trns-into-cl > font").html(e),t(".trns-into").find(".trns-into-cl > font").toggle()}}),t(document).delegate(".trns-lang-all","click",function(){var e=t(this).attr("id").split("-")[0],n=new Date((new Date).getTime()+18e5),a=t(this).get(0).outerHTML;a=(a=a.replace(/id=[\'\"](\w+)-\d+[\'\"]/,'id="$1-0"')).replace("trns-lang-all","trns-temporary"),t(".trns-temporary").remove(),t(".lang-board").find(".show-all-langs").before(a),wpdiscuzAjaxObj.isCookiesEnabled&&(document.cookie="translateLanguage="+e+"; expires="+n)}),t(document).delegate(".wpd_editable_comment","click",function(){t(this).parents(".wpd-comment").find(".wc-comment-translated-text").remove(),t(this).parents(".wpd-comment").find(".original-text").hide(),t(this).parents(".wpd-comment").find(".trns-moderate-comments").show(),t(this).parents(".wpd-comment").find(".wpd-comment-text").show()}),t(document).delegate(".wpd_save_edited_comment","mousedown",function(){t(this).parents(".wpd-comment").find(".original-text").hide(),t(this).parents(".wpd-comment").find(".trns-moderate-comments").show(),t(this).parents(".wpd-comment").find(".trns-moderate-comment").attr("data-lang","none")})});