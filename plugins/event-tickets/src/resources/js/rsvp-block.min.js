var tribe_tickets_rsvp_block={events:{}};!function(t,e){"use strict";e.state={submitActive:!0},e.tribe_rsvp_toggle_actions=function(t){var e=t.hasClass("tribe-block__rsvp__status-button--going")?".tribe-block__rsvp__status-button--not-going":".tribe-block__rsvp__status-button--going",i=t.closest(".tribe-block__rsvp__status").find(e);t.addClass("tribe-active"),t.removeClass("tribe-inactive"),t.attr("disabled","disabled"),i.addClass("tribe-inactive"),i.removeClass("tribe-active"),i.removeAttr("disabled")},e.events.handle_rsvp_response=function(){var i=t(this),s=i.closest(".tribe-block__rsvp"),r=s.find(".tribe-block__rsvp__ticket"),n=r.data("rsvp-id"),_=i.hasClass("tribe-block__rsvp__status-button--going");e.tribe_rsvp_toggle_actions(i);var a={action:"rsvp-form",ticket_id:n,going:_?"yes":"no"};e.tribe_rsvp_loader_start(),t.post(TribeRsvp.ajaxurl,a,function(t){s.find(".tribe-block__rsvp__message__success").remove();var i=r.find(".tribe-block__rsvp__form");if(i.html(t.data.html),window.tribe_event_tickets_plus){var n=i.find("input.tribe-tickets-quantity");window.tribe_event_tickets_plus.meta.block_set_quantity(n,_)}e.validate_submission(i)||(i.find(".tribe-block__rsvp__submit-button").attr("disabled",!0),e.state.submitActive=!1);e.tribe_rsvp_loader_end()})},e.events.handle_quantity_change=function(e){e.preventDefault();var i=t(this).parent().find('input[type="number"]'),s=t(this).hasClass("tribe-block__rsvp__number-input-button--plus"),r=i[0].step?Number(i[0].step):1,n=Number(i[0].value);if(s){var _=i[0].max?Number(i[0].max):-1;if("function"==typeof i[0].stepUp)try{if(_<n+r)return;i[0].stepUp()}catch(t){i[0].value=-1===_||_>=n+r?n+r:_}else i[0].value=-1===_||_>=n+r?n+r:_}else{var a=i[0].min?Number(i[0].min):0;if("function"==typeof i[0].stepDown)try{i[0].stepDown()}catch(t){i[0].value=a<=n-r?n-r:a}else i[0].value=a<=n-r?n-r:a}n!==i[0].value&&i.trigger("change")},e.events.handle_quantity_change_value=function(e){e.preventDefault();const i=t(e.target),s=(i.closest("form"),i.attr("max"));let r=parseInt(i.val(),10);s<(r=isNaN(r)?0:r)&&(r=s,i.val(s)),e.preventDefault()},e.events.handle_input_focus=function(i){e.state.submitActive||(t(i.target).siblings(".tribe-block__rsvp__submit-button").attr("disabled",!1),e.state.submitActive=!0)},e.tribe_rsvp_loader_start=function(e){t(".tribe-block__rsvp").find(".tribe-block__rsvp__loading").removeClass("tribe-common-a11y-hidden")},e.tribe_rsvp_loader_end=function(e){t(".tribe-block__rsvp").find(".tribe-block__rsvp__loading").addClass("tribe-common-a11y-hidden")},e.validate_submission=function(e){var i=e.find("input.tribe-tickets-quantity"),s=e.find("input.tribe-tickets-full-name"),r=e.find("input.tribe-tickets-email");return t.trim(s.val()).length&&t.trim(r.val()).length&&parseInt(i.val())>0},e.events.handle_submission=function(i){i.preventDefault();var s=t(this).closest(".tribe-block__rsvp__ticket"),r=s.data("rsvp-id"),n=s.find("form"),_=e.validate_submission(n),a=!0,o=!!window.tribe_event_tickets_plus;if(o&&(a=window.tribe_event_tickets_plus.meta.validate_meta(n)),_&&a){var b=n.serializeArray();b.push({name:"action",value:"rsvp-process"}),b.push({name:"ticket_id",value:r}),e.tribe_rsvp_loader_start(),t.post(TribeRsvp.ajaxurl,b,function(t){var i=t.data.remaining;s.find(".tribe-block__rsvp__details .tribe-block__rsvp__availability").replaceWith(t.data.remaining_html),s.find(".tribe-block__rsvp__form").empty(),s.closest(".tribe-block__rsvp").append(t.data.html),0===i&&s.find(".tribe-block__rsvp__status").replaceWith(t.data.status_html),e.tribe_rsvp_loader_end()})}else _?n.find(".tribe-block__rsvp__message__error").hide():n.find(".tribe-block__rsvp__message__error").show(),o&&a?n.find(".tribe-event-tickets-meta-required-message").hide():n.find(".tribe-event-tickets-meta-required-message").show(),t("html, body").animate({scrollTop:n.offset().top-100},300)},e.bind_events=function(){t(".tribe-block__rsvp__ticket").on("click",".tribe-block__rsvp__status-button--going, .tribe-block__rsvp__status-button--not-going",e.events.handle_rsvp_response).on("click",'button[type="submit"]',e.events.handle_submission).on("click",".tribe-block__rsvp__number-input-button--minus, .tribe-block__rsvp__number-input-button--plus",e.events.handle_quantity_change).on("change keyup",".tribe-tickets-quantity",e.events.handle_quantity_change_value).on("focus",".tribe-tickets-full-name, .tribe-tickets-email",e.events.handle_input_focus)},e.init=function(){t(".tribe-block__rsvp").length&&e.bind_events()},e.init()}(jQuery,tribe_tickets_rsvp_block);